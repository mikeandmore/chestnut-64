#!/bin/bash

# generate acpica build configuration

ACPICA_BUILD_CONF="acpica.ninja"

function gen_acpica() {
    local ACPICA_OBJ=""
    echo "" > ${ACPICA_BUILD_CONF}
    for f in `find kern/acpica -name '*.c'`; do
        local SRC=$f
        local OBJ="`dirname $f`/```basename $f .c`.o"
        echo "build ${OBJ}: cc ${SRC}" >> acpica.ninja
        ACPICA_OBJ="${ACPICA_OBJ} ${OBJ}"
    done

    echo "" >> ${ACPICA_BUILD_CONF}

    echo "build kern/libacpica.a : ar ${ACPICA_OBJ}" >> ${ACPICA_BUILD_CONF}
}

function gen_cflags() {
    local BUILD=$1
    echo "Generating Ninja Configuration for ${BUILD}"

    if [ ${BUILD} = "Release" ]; then
        echo "cbaseflags = -O3" > flags.ninja
    elif [ ${BUILD} = "Debug" ]; then
        echo "cbaseflags = -g" > flags.ninja
    fi
}

if [ $# -eq 0 ]; then
    echo "$0 [Release|Debug]"
    exit -1
fi

gen_cflags $1

gen_acpica

